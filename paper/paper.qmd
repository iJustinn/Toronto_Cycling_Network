---
title: "Geospatial and Temporal Analysis of Toronto's Cycling Infrastructure"
subtitle: "A Data-Driven Approach"
author: 
  - Ziheng Zhong
thanks: "Code and data are available at: https://github.com/iJustinn/Toronto_Cycling_Network"
date: today
date-format: long
abstract: "This study examines the evolution of Toronto's cycling infrastructure between 2001 and 2024, focusing on installation trends, upgrades, and comfort levels of bike lanes. The analysis reveals that while the cycling network has grown, many lanes remain low in comfort, with significant disparities in access between downtown and suburban areas. These findings highlight the need for continued investment in upgrading existing lanes and expanding the network to promote safer and more equitable cycling options across the city. Such improvements are essential for supporting sustainable transportation and reducing car dependency in Toronto."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# Package List
package_list <- c("sf", "readr", "ggplot2", "osmdata", "tidyverse", "jsonlite", "dplyr", "here", "knitr", "kableExtra")

# Check and install missing packages
install_and_load <- function(package_list) {
  for (package in package_list) {
    if (!require(package, character.only = TRUE)) {
      install.packages(package)
      library(package, character.only = TRUE)
    }
  }
}

install_and_load(package_list)

```



# Introduction

The development of urban cycling infrastructure is critical for promoting sustainable transportation, reducing greenhouse gas emissions, and improving public health. In rapidly growing cities like Toronto, the integration of cycling lanes into the urban transportation system provides an alternative to car dependency, addressing concerns related to traffic congestion and environmental sustainability. However, despite Toronto’s growing network of bike lanes, there remains significant variation in the quality and accessibility of these lanes, particularly between downtown and suburban areas. For most Toronto residents, they may see some bicycles riding on the road everyday, but there is a high probability that there is no clear understanding of Toronto's bike lanes construction. This paper is meant to fulfill this knowledge gap and give people an overall understanding on Toronto's cycling network development and why it is important.

This paper focuses on the evolution of Toronto’s cycling infrastructure from 2001 to 2024, providing a geospatial and temporal analysis of bikeway installations, upgrades, and comfort levels across the city. Using the publicly available 'Cycling Network' dataset [@citeCyclingNetwork] from Open Data Toronto [@citeODT], this study investigates the distribution of bike lanes, the different lanes' comfort levels with its classifications, and the trends in cycling infrastructure development over the past two decades. It highlights the differences in the network's coverage between the densely populated downtown core and the more sparsely served suburban regions.

A critical gap in the literature is the lack of detailed, data-driven studies assessing the quality of Toronto’s cycling infrastructure. While the city has made strides in expanding its network, many lanes remain of low comfort, which may discourage public choosing cycling as a daily mode of transportation. This paper aims to solve this problem by analyzing both the growth of the network and its current state in terms of usability and safety.

To address this, the study evaluates the installation and upgrade trends of bike lanes, classifies the comfort levels of these lanes, and identifies areas where further investment is necessary. The results indicate that while Toronto’s cycling network has expanded, many lanes offer minimal physical protection, with significant underinvestment in suburban areas. These findings underscore the need for continuous improvements to both the safety and accessibility of the network, which are essential for supporting Toronto’s broader goals of sustainable urban mobility.

The importance of this study lies in its potential to inform urban planners and policymakers about the current shortcomings of Toronto’s cycling infrastructure. By emphasizing the need for targeted investments, particularly in underserved regions, the study contributes to ongoing efforts to make cycling a more viable and equitable transportation option across the city.

The structure of this paper is organized as follows: @sec-data presents the data sources, methodologies, and the visualization of the results. The findings are then discussed in @sec-dis, and additional detailed information is provided in the appendix at @sec-app.

# Data {#sec-data}

This project is motivated and guided by Rohan Alexander and his book [@citeTbook]. Data used in this paper was downloaded, cleaned and analyzed with the programming language R [@citeR]. Also with support of additional packages in R: `sf` [@citeSf], `readr` [@citeReadr], `ggplot2` [@citeGgplot2], `osmdata` [@citeOsmdata], `tidyverse` [@citeTidyverse], `jsonlite` [@citeJsonlite], `dplyr` [@citeDplyr], `here` [@citeHere], `knitr` [@citeKnitr], `kableExtra` [@citeKableExtra].

## Source
The dataset analyzed in this study, the Cycling Network dataset [@citeCyclingNetwork], was retrieved from Open Data Toronto [@citeODT]. This dataset is publicly available and is continually updated to reflect Toronto’s ongoing efforts to develop and maintain its cycling infrastructure. It contains geospatial and temporal information about various cycling-related features, including the types of bikeways, installation years, etc. Such a detailed history of Toronto's cycling network development shows a good fit for this study.

While the Cycling Network dataset was the primary source of data, other relevant datasets were explored, such as the Road Network File [@citeStatCan] from Statistics Canada, which provides detailed geospatial data on all roadways in Toronto. Another alternative was the Major City-Wide Cycling Routes dataset [@citeCyclingRoutes], also available on Open Data Toronto [@citeODT]. However, this dataset focuses specifically on the large-scale cycling routes connecting different parts of the city, emphasizing connectivity at a macro level. While these two dataset are useful for analyzing high-level transportation patterns, it lacks the detailed data such as comfort levels, installation dates, and upgrade history, that are crucial for a deep analysis of cycling infrastructure. Since this paper focuses on both the growth and quality of cycling infrastructure, the Cycling Network dataset, with its more comprehensive coverage of individual bikeway segments, was a better fit for the goals of this study.

## Measurement

The 'Cycling Network' dataset from Open Data Toronto tracks various aspects of Toronto's cycling infrastructure, such as installation dates, upgrades, street names, and the type of the lane. Each entry represents a segment of the cycling network, such as the construction or upgrading of cycling paths, are documented. For example, when a cycling path is installed or upgraded, the responsible authorities collect information such as the installation year and any year of subsequent upgrades. This data is then inputed into structured entries in the dataset.

To go from a physical event, such as installing a new lane, to a dataset entry, detailed records are maintained by the city's transportation department. These records include precise latitude and longitude of the lanes, allowing each cycling path to be mapped precisely in relation to other city infrastructure. Thus, the phenomena of constructing or updating a bike lane becomes an entry with attributes such as the street name, road class, and installation history. This allows researchers to analyze trends in cycling infrastructure and its expansion over time.

### Variables

The various variables mentioned above serves as key variables that were used in analysis for this paper:

#### Installation Year

The Installation Year records the year in which a particular bikeway segment was first constructed or made available for use. This variable is essential for conducting a temporal trend analysis, allowing the study to track the growth and expansion of the cycling network over time.

#### Upgrade Year

The Upgrade Year indicates when an existing bikeway segment was upgraded or improved. Upgrades typically involve safety enhancements, such as the installation of protective barriers, widening of lanes, or changes from painted lanes to physically separated lanes. This variable is critical for assessing not just the expansion but also the quality improvements made to Toronto’s cycling infrastructure over time. Tracking upgrades helps to understand whether the city's focus has shifted from merely adding new bikeways to improving the usability and safety of existing ones, especially in high-traffic or critical areas.

#### Bikeway Type

The Bikeway Type categorizes the cycling infrastructure into different types, including dedicated bike lanes, multi-use trails, and shared roadways, etc. Each type of bikeway offers varying levels of protection and comfort to cyclists. This variable was not directly used in the study, but forming another crucial variable: Comfort Level.

#### Comfort Level

Each bikeway is assigned a comfort level—high, moderate, or low—based according to the recorded Bikeway Type. These classification are self-defined, reling on factors such as physical separation from traffic and lane width of each Bikeway Type, detail can be found in @sec-app-comfort. This variable is central to understanding the usability of the infrastructure.

#### Geospatial Coordinates
Latitude and longitude data are included to map the bikeways and assess their spatial distribution.

## Method {#sec-data-method}

```{r}
#| echo: false
#| eval: true
#| label: tbl-raw-coordinates
#| tbl-cap: "Raw Coordinates"
#| warning: false

# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

# Extract the first part of the geometry string for each row
data_geometry <- data %>%
  mutate(simplified_geometry = substr(geometry, 1, 92)) %>%  # Extract the first 100 characters
  select(simplified_geometry)

# Display the simplified geometry data
head(data_geometry) %>%
  kable("latex", booktabs = TRUE, col.names = c("Geometry")) %>%
  column_spec(1, width = "40em")  # Adjust the width as needed

```

```{r}
#| echo: false
#| eval: true
#| label: tbl-clean-coordinates
#| tbl-cap: "Extracted and Cleaned Coordinates"
#| warning: false


# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

# Function to extract and clean coordinates from geometry
extract_coordinates <- function(geo) {
  if (!is.na(geo)) {
    geo_clean <- gsub("'", "\"", geo)
    json_data <- tryCatch({
      fromJSON(geo_clean)
    }, error = function(e) {
      return(NULL)
    })
    
    if (!is.null(json_data) && !is.null(json_data$coordinates)) {
      coords <- unlist(json_data$coordinates, recursive = TRUE)
      longitude <- coords[grepl("^-79", coords)]
      latitude <- coords[grepl("^43", coords)]
      if (length(longitude) == length(latitude)) {
        coords_matrix <- cbind(longitude, latitude)
        return(as.data.frame(coords_matrix))
      }
    }
  }
  return(NULL)
}

# Extract coordinates and clean data
all_coordinates <- lapply(data$geometry, extract_coordinates)
valid_coordinates <- all_coordinates[!sapply(all_coordinates, is.null)]
data$id <- seq_len(nrow(data))
coordinates_data <- do.call(rbind, Map(function(coords, id) {
  coords$id <- id
  return(coords)
}, valid_coordinates, data$id[!sapply(all_coordinates, is.null)]))

# Set column names and remove NA values
colnames(coordinates_data) <- c("Longitude", "Latitude", "ID")
coordinates_data <- coordinates_data %>% filter(!is.na(Longitude), !is.na(Latitude))

# Display the first few rows of the cleaned coordinate data
head(coordinates_data) %>%
  kable("latex", booktabs = TRUE, col.names = c("Longitude", "Latitude", "ID"))

```

In the first data cleaning process, the focus was on extracting and cleaning geographical coordinates from the 'geometry' column, which all data are in JSON-like format, @tbl-raw-coordinates displays how the raw data was like. A function was created to parse the coordinates, filter out invalid entries, and extract the longitude and latitude values. The extracted coordinates were combined into a new dataset shown in @tbl-clean-coordinates, with unique IDs to match the original cycling lanes they from. Any rows with missing coordinate data were removed, and the cleaned data was saved into a separate file for further analysis.

```{r}
#| echo: false
#| eval: true
#| label: tbl-clean-upgraded
#| tbl-cap: "Number of Bikeways Upgraded by Year"
#| warning: false

# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

# Step 1: Select the 'UPGRADED' column
upgraded_data <- data %>%
  select(UPGRADED)

# Step 2: Filter out invalid and missing years
upgraded_data <- upgraded_data %>%
  filter(!is.na(UPGRADED) & UPGRADED > 1800)  # Keep valid years only

# Step 3: Convert the 'UPGRADED' column to numeric
upgraded_data <- upgraded_data %>%
  mutate(UPGRADED = as.numeric(UPGRADED))

# Step 4: Group the data by the year of upgrade and summarize the number of upgrades
upgraded_summary <- upgraded_data %>%
  group_by(UPGRADED) %>%
  summarise(num_lanes = n())

# Step 5: Display the summarized data in a table
tail(upgraded_summary) %>%
  kable("latex", booktabs = TRUE, col.names = c("Year", "Total Upgraded"))

```

The second cleaning process dealt with the 'UPGRADED' column, which contains information about the years when cycling lanes were upgraded. Invalid or missing years were filtered out, and the remaining valid data was converted to a numeric format. The dataset was then grouped by the year of upgrade, with a summary created to count the number of lanes upgraded in each year. This summarized data, @tbl-clean-upgraded, was saved for use in analyzing trends in lane upgrades over time.

```{r}
#| echo: false
#| eval: true
#| label: tbl-clean-installed
#| tbl-cap: "Number of Bikeways Installed by Year"
#| warning: false

# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

# Step 1: Select the 'INSTALLED' column
installed_data <- data %>%
  select(INSTALLED)

# Step 2: Filter out invalid and missing years
installed_data <- installed_data %>%
  filter(!is.na(INSTALLED) & INSTALLED > 1800)  # Keep valid years only

# Step 3: Convert the 'INSTALLED' column to numeric
installed_data <- installed_data %>%
  mutate(INSTALLED = as.numeric(INSTALLED))

# Step 4: Group the data by the year of installation and summarize the number of installations
installed_summary <- installed_data %>%
  group_by(INSTALLED) %>%
  summarise(num_bikeways = n())

# Step 5: Display only the first 6 rows of the summarized data in a table
head(installed_summary) %>%
  kable("latex", booktabs = TRUE, col.names = c("Year", "Total Installed"))

```

In the third cleaning process, the focus was on the 'INSTALLED' column, which records the years when cycling infrastructure was first installed. Similar to the 'UPGRADED' column, invalid or missing years were removed, and the data was converted to numeric format. The installation data was grouped by year to count the number of bikeways installed each year. The resulting summary, @tbl-clean-installed, was saved for further trend analysis on the growth of the cycling network.

```{r}
#| echo: false
#| eval: true
#| label: tbl-clean-comfort
#| tbl-cap: "Classification of Cycling Lanes by Comfort Level"
#| warning: false

# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

# Step 1: Select relevant columns for classification
lane_type_data <- data %>%
  select(INFRA_HIGHORDER, INFRA_LOWORDER, INSTALLED, UPGRADED)

# Step 2: Filter out rows with missing values in the relevant columns
lane_type_data <- lane_type_data %>%
  filter(!is.na(INFRA_HIGHORDER) & !is.na(INFRA_LOWORDER))

# Step 3: Classify lanes into comfort levels based on infrastructure types
lane_type_data <- lane_type_data %>%
  mutate(
    Comfort_Level = case_when(
      str_detect(INFRA_HIGHORDER, "Protected|Multi-Use") | str_detect(INFRA_LOWORDER, "Protected|Multi-Use") ~ "High Comfort",
      str_detect(INFRA_HIGHORDER, "Bike Lane") | str_detect(INFRA_LOWORDER, "Bike Lane") ~ "Moderate Comfort",
      TRUE ~ "Low Comfort"
    )
  )

# Step 4: Select relevant columns to display (Comfort Level, Installed, and Upgraded year)
final_lane_data <- lane_type_data %>%
  select(INSTALLED, UPGRADED, Comfort_Level)

# Step 5: Display the first 6 rows of the cleaned and classified data
head(final_lane_data) %>%
  kable("latex", booktabs = TRUE, col.names = c("Installed Year", "Upgraded Year", "Comfort Level"))

```

Finally, the fourth cleaning process involved classifying cycling lanes based on the type of infrastructure. Data from the 'INFRA_HIGHORDER' and 'INFRA_LOWORDER' columns was cleaned, and missing values were removed. By using the Bikeway Type data, the lanes were classified into three comfort levels: High Comfort, Moderate Comfort, and Low Comfort, detail of this classification can be found in @sec-app-comfort. The classification, along with year data for installation and upgrades, was saved for analysis on the types of cycling lanes and their comfort levels. @tbl-clean-comfort shows how it looks like.

## Charts

### Data Trend

```{r}
#| label: fig-installed
#| fig-cap: "Toronto Bikeways Installed by Year"
#| fig-subcap: ["Number of bikeways installed", "Trend of bikeway installations"]
#| echo: false
#| warning: false
#| message: false
#| layout-ncol: 2
#| layout-nrow: 1

# Load the data
installed_data <- read_csv(here("data", "analysis_data", "installed_data.csv"))

# Generate the bar chart for "Number of Bikeways Installed by Year"
ggplot(installed_data, aes(x = INSTALLED, y = num_bikeways)) +
  geom_bar(stat = "identity", fill = "darkgrey") +  # Bar chart
  labs(x = "Year of Installation",
       y = "Number of Bikeways") +
  scale_x_continuous(breaks = seq(min(installed_data$INSTALLED), max(installed_data$INSTALLED), by = 1)) +  # Display all years
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels for readability



# Generate the line chart with trend line for "Number of Bikeways Installed by Year"
ggplot(installed_data, aes(x = INSTALLED, y = num_bikeways)) +
  geom_line(aes(group = 1), color = "black", size = 1) +  # Adds a line connecting each point
  geom_point(color = "black", size = 2) +  # Adds points at each data value
  geom_smooth(method = "lm", color = "red", se = FALSE) +  # Adds a linear trend line
  labs(x = "Year of Installation",
       y = "Number of Bikeways") +
  scale_x_continuous(breaks = seq(min(installed_data$INSTALLED), max(installed_data$INSTALLED), by = 1)) +  # Display all years
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels for readability

```

@fig-installed consists of two panels depicting the number of bikeways installed in Toronto by year, alongside a trend analysis of the installation pattern over time. @fig-installed-1 displays the raw count of bikeways installed per year from 2001 to 2024. A significant spike is observed in 2001, with over 400 bikeways installed in that year alone. This likely reflects the starting time of this dataset, which all lanes built before 2001 was recorded as 2001. Following 2001, the number of installations drops sharply and stabilizes at much lower levels in subsequent years, with occasional small peaks around 2007, 2011, and 2021.

@fig-installed-2 adds a trend line to the same data, showing a gradual decline in the number of bikeways installed over time. The trend line, sloping downward, indicates that despite some fluctuations, the overall pattern is a decrease in annual bikeway installations. The early 2000s marked a high point for cycling infrastructure development, but after this surge, the rate of installation has steadily declined. This trend might reflect a shift in city planning priorities or the saturation of available spaces for bikeways in certain areas. The analysis highlights the need for renewed focus on expanding cycling infrastructure to sustain or increase the momentum of bike-friendly urban development.

```{r}
#| label: fig-upgraded
#| fig-cap: "Toronto Bikeways Upgraded by Year"
#| fig-subcap: ["Number of bikeways upgraded", "Trend of bikeway upgrads"]
#| echo: false
#| warning: false
#| message: false
#| layout-ncol: 2
#| layout-nrow: 1

# Load the data
upgraded_data <- read_csv(here("data", "analysis_data", "upgraded_data.csv"))

# Generate the bar chart for "Number of Bikeways Upgraded by Year"
ggplot(upgraded_data, aes(x = UPGRADED, y = num_lanes)) +
  geom_bar(stat = "identity", fill = "darkgrey") +  # Bar chart
  labs(x = "Year of Upgrade",
       y = "Number of Bikeways") +
  scale_x_continuous(breaks = seq(min(upgraded_data$UPGRADED), max(upgraded_data$UPGRADED), by = 1)) +  # Display all years
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels for readability



# Generate the line chart with trend line for "Number of Bikeways Upgraded by Year"
ggplot(upgraded_data, aes(x = UPGRADED, y = num_lanes)) +
  geom_line(aes(group = 1), color = "black", size = 1) +  # Adds a line connecting each point
  geom_point(color = "black", size = 2) +  # Adds points at each data value
  geom_smooth(method = "lm", color = "red", se = FALSE) +  # Adds a linear trend line
  labs(x = "Year of Upgrade",
       y = "Number of Bikeways") +
  scale_x_continuous(breaks = seq(min(upgraded_data$UPGRADED), max(upgraded_data$UPGRADED), by = 1)) +  # Display all years
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels for readability

```

@fig-upgraded illustrates the number of bikeways upgraded in Toronto from 2001 to 2024, with panel (a) showing the raw counts of upgrades and panel (b) visualizing the trend. @fig-upgraded-1 reveals that the most significant number of upgrades occurred in 2015, where nearly 100 bikeways were updated, marking a major peak. Outside of this spike, the number of annual upgrades remains relatively modest, typically fluctuating between 10 and 50 bikeways each year. Notable periods of increased upgrades are visible around 2012 and 2020, possibly reflecting concentrated efforts to modernize or expand existing cycling infrastructure in those years.

In @fig-upgraded-2, the overall trend is slightly upward, as indicated by the red trend line. Despite the notable peaks and drops, the trend line suggests that, on average, the number of bikeway upgrades has increased over the years. The spike in 2015 significantly affects the trend, but even excluding that, the gradual rise suggests that more consistent efforts have been made to maintain and improve Toronto’s cycling network. This trend aligns with broader urban planning strategies focused on making cities more accessible and environmentally friendly by supporting active transportation. The dips in recent years, particularly after 2020, might be influenced by resource reallocation or external factors, such as the global pandemic, which could have delayed some plans.

### Distributions

```{r}
#| label: fig-comfort-one
#| fig-cap: "Toronto Bikeway Comfort Level Distribution"
#| fig-subcap: ["Comfort Levels", "Low Comfort"]
#| echo: false
#| warning: false
#| message: false
#| layout-ncol: 2
#| layout-nrow: 1
#| fig-width: 12
#| fig-height: 7

# Load the data
lane_type_data <- read_csv(here("data", "analysis_data", "lane_type_data.csv"))

# Combine the 'INSTALLED' and 'UPGRADED' years into one column for better visualization
lane_type_years <- lane_type_data %>%
  pivot_longer(cols = c(INSTALLED, UPGRADED), names_to = "Year_Type", values_to = "Year") %>%
  filter(!is.na(Year)) %>%  # Remove NA values in the 'Year' column
  group_by(Comfort_Level) %>%
  summarise(count = n())  # Count the occurrences of each Comfort Level

# Calculate percentages
lane_type_years <- lane_type_years %>%
  mutate(percentage = round((count / sum(count)) * 100, 2))  # Add percentage column

# Define a more contrasting Morandi-inspired color scheme
contrasting_morandi_colors <- c(
  "High Comfort" = "#B39B8E",   # Muted brownish-pink
  "Moderate Comfort" = "#8A7967", # Stronger grey-brown
  "Low Comfort" = "#6E7062"     # Dark muted gray-green
)

# Generate the pie chart with border lines and larger text/legend
ggplot(lane_type_years, aes(x = "", y = percentage, fill = Comfort_Level)) +
  geom_bar(stat = "identity", width = 1, color = "black") +  # Add black border lines around pie sections
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(percentage, "%")), 
            position = position_stack(vjust = 0.5), 
            size = 6,   # Increase text size for percentage labels
            fontface = "bold") +  # Make percentage text bold
  scale_fill_manual(values = contrasting_morandi_colors) +  # Apply the more contrasting Morandi colors
  labs(fill = "Comfort Level") +
  theme_void() +  # Remove axis, grid lines, and background
  theme(legend.position = "right", 
        legend.title = element_text(size = 16),  # Increase legend title size
        legend.text = element_text(size = 14))  # Increase legend text size



# Filter data for 'Low Comfort' lanes and categorize as 'Upgraded' or 'Not Upgraded'
low_comfort_data <- lane_type_data %>%
  filter(Comfort_Level == "Low Comfort") %>%
  mutate(
    Upgrade_Status = ifelse(is.na(UPGRADED), "Not Upgraded", "Upgraded")
  ) %>%
  group_by(Upgrade_Status) %>%
  summarise(count = n())  # Count the occurrences of each category

# Calculate percentages
low_comfort_data <- low_comfort_data %>%
  mutate(percentage = round((count / sum(count)) * 100, 2))  # Add percentage column

# Define colors for 'Upgraded' and 'Not Upgraded' categories
upgrade_colors_low <- c(
  "Upgraded" = "#8A7967",  # Gray-brown for upgraded
  "Not Upgraded" = "#B39B8E"  # Muted pinkish tone for not upgraded
)

# Generate the pie chart with borders and larger text/legend for Low Comfort lanes
ggplot(low_comfort_data, aes(x = "", y = percentage, fill = Upgrade_Status)) +
  geom_bar(stat = "identity", width = 1, color = "black") +  # Add black border lines around pie sections
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(percentage, "%")), 
            position = position_stack(vjust = 0.5), 
            size = 6,   # Increase text size for percentage labels
            fontface = "bold") +  # Make percentage text bold
  scale_fill_manual(values = upgrade_colors_low) +  # Apply colors for Upgraded vs Not Upgraded
  labs(fill = "Upgrade Status") +
  theme_void() +  # Remove axis, grid lines, and background
  theme(legend.position = "right", 
        legend.title = element_text(size = 16),  # Increase legend title size
        legend.text = element_text(size = 14))  # Increase legend text size

```

@fig-comfort-one provides a breakdown of Toronto’s bikeway network by comfort level and upgrade status. @fig-comfort-one-1 shows the distribution of all bikeways based on comfort level, with the majority of bikeways classified as either Low Comfort (40.88%) or Moderate Comfort (41.75%), while High Comfort lanes constitute a smaller portion (17.36%). This indicates that while Toronto has invested in a significant number of bike lanes, most of them fall within lower comfort categories, suggesting that further improvements, particularly in upgrading existing lanes, are needed to promote safer and more comfortable cycling experiences.

```{r}
#| label: fig-comfort-two
#| fig-cap: "Toronto Bikeway Comfort Level Distribution"
#| fig-subcap: ["Moderate Comfort", "High Comfort"]
#| echo: false
#| warning: false
#| message: false
#| layout-ncol: 2
#| layout-nrow: 1
#| fig-width: 12
#| fig-height: 7

# Load the data
lane_type_data <- read_csv(here("data", "analysis_data", "lane_type_data.csv"))

# Filter data for 'Moderate Comfort' lanes and categorize as 'Upgraded' or 'Not Upgraded'
moderate_comfort_data <- lane_type_data %>%
  filter(Comfort_Level == "Moderate Comfort") %>%
  mutate(
    Upgrade_Status = ifelse(is.na(UPGRADED), "Not Upgraded", "Upgraded")
  ) %>%
  group_by(Upgrade_Status) %>%
  summarise(count = n())  # Count the occurrences of each category

# Calculate percentages
moderate_comfort_data <- moderate_comfort_data %>%
  mutate(percentage = round((count / sum(count)) * 100, 2))  # Add percentage column

# Define colors for 'Upgraded' and 'Not Upgraded' categories
upgrade_colors_moderate <- c(
  "Upgraded" = "#8A7967",  # Gray-brown for upgraded
  "Not Upgraded" = "#B39B8E"  # Muted pinkish tone for not upgraded
)

# Generate the pie chart for Moderate Comfort lanes
ggplot(moderate_comfort_data, aes(x = "", y = percentage, fill = Upgrade_Status)) +
  geom_bar(stat = "identity", width = 1, color = "black") +  # Add black border lines around pie sections
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(percentage, "%")), 
            position = position_stack(vjust = 0.5), 
            size = 6,   # Increase text size for percentage labels
            fontface = "bold") +  # Make percentage text bold
  scale_fill_manual(values = upgrade_colors_moderate) +  # Apply colors for Upgraded vs Not Upgraded
  labs(fill = "Upgrade Status") +
  theme_void() +  # Remove axis, grid lines, and background
  theme(legend.position = "right", 
        legend.title = element_text(size = 16),  # Increase legend title size
        legend.text = element_text(size = 14))  # Increase legend text size



# Filter data for 'High Comfort' lanes and categorize as 'Upgraded' or 'Not Upgraded'
high_comfort_data <- lane_type_data %>%
  filter(Comfort_Level == "High Comfort") %>%
  mutate(
    Upgrade_Status = ifelse(is.na(UPGRADED), "Not Upgraded", "Upgraded")
  ) %>%
  group_by(Upgrade_Status) %>%
  summarise(count = n())  # Count the occurrences of each category

# Calculate percentages
high_comfort_data <- high_comfort_data %>%
  mutate(percentage = round((count / sum(count)) * 100, 2))  # Add percentage column

# Define colors for 'Upgraded' and 'Not Upgraded' categories
upgrade_colors_high <- c(
  "Upgraded" = "#8A7967",  # Gray-brown for upgraded
  "Not Upgraded" = "#B39B8E"  # Muted pinkish tone for not upgraded
)

# Generate the pie chart for High Comfort lanes
ggplot(high_comfort_data, aes(x = "", y = percentage, fill = Upgrade_Status)) +
  geom_bar(stat = "identity", width = 1, color = "black") +  # Add black border lines around pie sections
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(percentage, "%")), 
            position = position_stack(vjust = 0.5), 
            size = 6,   # Increase text size for percentage labels
            fontface = "bold") +  # Make percentage text bold
  scale_fill_manual(values = upgrade_colors_high) +  # Apply colors for Upgraded vs Not Upgraded
  labs(fill = "Upgrade Status") +
  theme_void() +  # Remove axis, grid lines, and background
  theme(legend.position = "right", 
        legend.title = element_text(size = 16),  # Increase legend title size
        legend.text = element_text(size = 14))  # Increase legend text size

```

@fig-comfort-one-2, @fig-comfort-two-1, and @fig-comfort-two-2 offer a deeper look into the upgrade status for each comfort level. For Low Comfort lanes, only 22.26% have been upgraded, while 77.74% remain in their original state. Similarly, for Moderate Comfort bikeways, 23.38% have been upgraded, leaving 76.62% untouched. Interestingly, High Comfort lanes have the lowest proportion of upgrades, with only 18.76% improved. This result shows not much cycling lanes achieved high comfort level by upgrading, most of them are initially designed and built to be high comfort lanes. These trends highlight a potential gap in Toronto's focus on maintaining and upgrading its most comfortable and accessible cycling lanes, suggesting a need for more targeted investments in high-comfort bikeways to encourage cycling in the city.

### Maps

```{r}
#| label: fig-map
#| fig-cap: "Map of Toronto Bikeway Locations"
#| echo: false
#| warning: false
#| message: false
#| fig-width: 11
#| fig-height: 8

# Load the data
coordinates_data <- read_csv(here("data", "analysis_data", "coordinates_data.csv"))

# Get bounding box for Toronto (approximate limits for Toronto)
toronto_bbox <- c(-79.6303856025883, 43.5822069220627, -79.1180336515019, 43.8554571861712)

# Fetch map data from OpenStreetMap (OSM)
toronto_map <- opq(bbox = toronto_bbox) %>%
  add_osm_feature(key = 'highway', value = 'primary') %>%
  add_osm_feature(key = 'highway', value = 'secondary') %>%
  add_osm_feature(key = 'highway', value = 'tertiary') %>%
  add_osm_feature(key = 'highway', value = 'residential') %>%
  osmdata_sf()

# Convert map data to Simple Features (sf) objects
streets <- toronto_map$osm_lines

# Plot the map with bike lanes data
ggplot() +
  geom_sf(data = streets, color = "gray", size = 0.3, alpha = 0.6) +  # OSM street map layer
  geom_point(data = coordinates_data, aes(x = longitude, y = latitude), 
             size = 0.1, color = "black") +  # Bike lanes points
  labs(x = "Longitude", y = "Latitude") +
  coord_sf(xlim = c(-79.6303856025883, -79.1180336515019), 
           ylim = c(43.5822069220627, 43.8554571861712), expand = FALSE) +
  theme_minimal() +
  theme(
    panel.background = element_blank(),  # Remove panel background
    panel.grid.major = element_blank(),  # Remove major grid lines
    panel.grid.minor = element_blank(),  # Remove minor grid lines
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  annotate("text", x = -79.12, y = 43.585, label = "Locations of bikeways in Toronto overlaid on a street map\
           including primary, secondary, tertiary, and residential roads.", 
           size = 5, hjust = 1, vjust = 0, color = "darkgrey")  # Caption at bottom right

```

@fig-map provides a visual representation of the bike lane infrastructure across Toronto. The lines on the map correspond to various cycling paths, which span different areas of the city. The geographic coordinates, ranging from around 43.60°N to 43.85°N in latitude and -79.6°W to -79.3°W in longitude, encompass most of Toronto’s urban region. This map offers an important spatial perspective, illustrating the extensive network of cycling routes that connect different neighborhoods and areas within the city.

A key observation from the map is the dense concentration of bike lanes in the downtown areas and along major roadways, indicating a well-established network in central Toronto. The downtown area’s grid-like structure is particularly evident, showcasing a high density of lanes that facilitate easy cycling access within the city's busiest areas. As one moves further away from the city center, the map shows fewer bike lanes, suggesting that suburban regions may have less developed cycling infrastructure. 

This map highlights the importance of cycling infrastructure in promoting sustainable urban transportation. The wide distribution of bike lanes supports Toronto's efforts to enhance active transportation options, reduce traffic congestion, and improve accessibility for cyclists. The representation also provides a foundation for analyzing areas where future infrastructure developments could be prioritized, particularly in regions where cycling connectivity appears sparse.

# Discussion {#sec-dis}

## Development of Toronto's Cycling Infrastructure

The data reveals a phased development of Toronto's cycling infrastructure, with a notable increase in installations during the early 2000s, as shown in @fig-installed. As mentioned before, this rise is likely due to the dataset starting in 2001, thereby recorded as 2001 for all installations prior to this year. However, if there was a large numebr of lanes installed in 2001, then it may reflect political momentum and public demand for environmentally sustainable transportation alternatives, influenced by growing concerns over climate change and urban congestion.

Ignoring the data from the first year, the annual number of new bikeway installations will still show a trend of slight decreasing. Several factors may account for this decline. In the early stages, the city's cycling plan likely targeted areas where infrastructure could be installed with relative low difficulties, particularly in downtown Toronto, where road networks and urban density favored such investments. As the network extended into more complex regions, such as suburban areas with fewer existing roadways, the rate of installation slowed. Moreover, the physical limitations of space in a densely developed urban environment likely constrained further expansion, as new bikeways would require more complex and expensive measures, such as road reallocation or the creation of shared-use paths.

Despite this slowdown in new installations, @fig-upgraded demonstrates a substantial focus on upgrading existing infrastructure, particularly in recent years. This shift from new installations to upgrades may indicate a strategic decision by the city to enhance the quality and safety of the current cycling infrastructure. As the infrastructure ages and new safety standards are introduced, upgrading older lanes is essential to ensuring the network remains functional and safe for cyclists. Also, some study have shown the possibilities of improving traffic issues by upgrading the existing cycling lanes [@citeCyclingImprove], this study also mentioned increasing the accessibility can highly impact people's will to choose cycling to commute.

The shift toward prioritizing upgrades over new installations also suggests that the initial expansion left certain areas with inadequate or unsafe infrastructure, particularly in the form of shared roadways or painted bike lanes offering minimal cyclist protection. As urban transportation planning evolves, the emphasis has shifted toward constructing more segregated and protected lanes, which are vital for encouraging cycling among less experienced riders or individuals concerned about safety. Considering new plans by the goverment [@citeCyclingNetworkPlan], this ongoing focus on improving infrastructure rather than simply expanding it, reflects a more advanced approach to active transportation, recognizing that safety and quality are equally important to increasing cycling participation.

## Comfort Level and Cyclist Safety

Comfort level classification is crucial for determining which segments of the population feel confident using the cycling network. Low Comfort lanes, including painted bike lanes and shared roadways, provide minimal physical separation from vehicular traffic. This limited protection often discourages risk-averse cyclists, particularly in areas with high traffic volumes. While such lanes may be acceptable in quieter residential areas, they are often avoided in busy urban environments. Unfortunately, as @fig-comfort-one-2 shows, 77.74% of these Low Comfort lanes remain unupgraded, revealing a substantial gap in the network's ability to offer safe and comfortable conditions for all cyclists.

Moderate Comfort lanes, which provide a higher degree of separation but still lack full physical barriers, also face similar issues. As indicated in @fig-comfort-two-1, 76.62% of Moderate Comfort lanes have not been upgraded. This shortfall presents a significant challenge in attracting cyclists to busier, high-traffic areas where perceived risk is still considerable. While Moderate Comfort lanes are an improvement over Low Comfort options, they may not sufficiently address the safety concerns of groups particularly sensitive to danger, such as women, children, and older adults.

Moreover, a study have shown the importance of buffer zones in cycling lanes [@citeLaneBuffer], it not only provide higher safety level, but also give people higer confidence to use these lanes when there are vehicles on the road. According to the Bikeway Comfort Level Distribution, @fig-comfort-one-1, a large portion of the network consists of lanes categorized as either High or Low Comfort, with Moderate Comfort lanes representing the samllest percentage. This distribution indicates that, although Toronto has expanded its cycling network, the infrastructure may still lack the high quality cycling lanes to encourage consistent cycling across mroe people. Ideally, Low Comfort lanes should form the smallest proportion, ensuring safer and more accessible routes for cyclists of all experience levels. In such cases, combining what we saw in the buffer zone study, there will be more usage of cycling lanes, thus help Toronto become a healthier and more environmental friendly city.

## Geospatial Distribution and Expansion Challenges

The geospatial analysis of Toronto's cycling infrastructure, as shown in @fig-map, reveals both strengths and gaps in the city's bike network. One key observation is the dense concentration of bikeways in the downtown Toronto. This concentration aligns with expectations, given that downtown areas are the city's most populated and crowded area, with high demand for alternative transportation options. The extensive network of bikeways in this region reflects a targeted effort to make cycling a viable and accessible mode of transportation for residents and visitors.

However, @fig-map also reveals a significant disparity in infrastructure coverage as one moves away from the city center toward suburban areas. In these regions, cycling infrastructure is sparse, underscoring unequal access to safe and efficient bike routes. This limited infrastructure in suburban areas reduces the overall utility of the city's cycling network, as it cannot connect to all areas that you may want to go. Several factors contribute to this discrepancy in cycling infrastructure. Suburban areas typically have lower population densities and roadways designed primarily for car travel, which historically has lowered the priority of cycling infrastructure. However, expand cycling lanes to these areas would still benefit people since it provids an alternative choice other than driving. This can also help those who haven't get a driver's license to have more flexible ways of transportation. As Toronto aims to promote sustainable transportation and reduce car dependency, prioritizing the development of safe cycling routes in suburban areas will be essential. Expanding infrastructure in these regions can significantly contribute to the city’s broader transportation and environmental goals [@citeEnvGoal].

@fig-map also emphasizes the importance of recreational areas, particularly those near the waterfront, in shaping the cycling network. These areas often feature multi use trails with High Comfort lanes, offering cyclists scenic and safe routes away from motor traffic. These trails serve not only as commuting routes but also as recreational spaces, promoting exercise and relaxation.

Finally, @fig-map points to opportunities for future expansion. Areas with few or no cycling routes should be considered for infrastructure development, especially where there is sufficient road space or public demand for safer cycling options. As Toronto continues to grow, addressing these gaps in the cycling network will be critical to ensuring that all residents, regardless of location, have access to safe, comfortable, and convenient cycling infrastructure. Lastly, it was mentioned as the first choice in the 'Low Carbon Transportation' article [@citeLowCarb] by City of Toronto, it further emphasized the importance of axpanding the network across the city to support the development of a more inclusive and sustainable transportation system.



## Weaknesses and next steps

One key limitation of this study is the reliance on the 'Cycling Network' dataset from Open Data Toronto, which, while comprehensive, might not capture informal or emerging cycling routes that are not officially recognized. Additionally, the dataset may not include newer infrastructure developments if updates were delayed in publication. Future research should integrate real-time data collection techniques or alternative datasets such as crowdsourced information to ensure that the analysis reflects the most current state of the network.

Another weakness lies in the classification of comfort levels, which is  useful but is an over simplification of this problem. Comfort in cycling can be influenced by numerous factors beyond infrastructure type, such as traffic density, road conditions, etc. A more comprehensive classification that incorporates these additional factors could provide a more accurate assessment of how good Toronto's cycling network truly is.

Next steps should include focusing on identifying areas with fewer bike lanes and lower comfort levels, particularly in suburban areas. These regions could be targeted for infrastructure upgrades and expansion to promote greater equity in access to safe cycling options. Additionally, analyzing cycling usage patterns, perhaps through mobile GPS data or surveys, would offer valuable insights into how the infrastructure is being utilized, helping city planners to make data-driven decisions in future expansions or upgrades.



\newpage



\appendix



# Appendix {#sec-app}

## Comfort Levels Classification {#sec-app-comfort}

### Data

```{r}
#| echo: false
#| eval: true
#| label: tbl-comfort
#| tbl-cap: "INFRA_HIGHORDER and INFRA_LOWORDER Columns from Raw Data"
#| warning: false

# Load the dataset
data <- read_csv(here("data", "raw_data", "raw_data.csv"))

comfort_data <- data %>%
  select(INFRA_HIGHORDER, INFRA_LOWORDER)

head(comfort_data) %>%
  kable("latex", booktabs = TRUE, col.names = c("INFRA_HIGHORDER", "INFRA_LOWORDER"))

```

The classification relies on the infrastructure types defined in two key columns: INFRA_HIGHORDER and INFRA_LOWORDER, shown in @tbl-comfort. As the author explained on the original dataset page [@citeCyclingNetwork]: "'INFRA-HIGH' refers to the highest classified cycling infrastructure type installed on this segment. 'INFRA-LOW' refers to the lowest classified cycling infrastructure type. The hierarchy is based on the quality and comfort of the bikeway type, with routes that are shared with vehicles as the lowest comfort, and the greater the separation / dedicated space, the higher the comfort and classification."

Both columns are crucial because they give complementary information about the physical features of the bikeway. By selecting these columns and ensuring that no missing values remain, the dataset is prepared for classification.

### Logic

The comfort levels are defined using a custom classification scheme based on the infrastructure types. The classification assigns a comfort level to each bikeway segment depending on its physical characteristics and separation from traffic:

#### High Comfort
Segments with infrastructure types labeled as "Protected" or "Multi-Use." These bikeways generally have physical barriers separating cyclists from motor vehicles, such as fully separated bike lanes or paths shared with pedestrians but removed from vehicle traffic. This category offers the highest level of safety and comfort, making it appealing to a wide range of cyclists, including families and less experienced riders.

#### Moderate Comfort
Bikeways labeled as "Bike Lane" in either column are classified as "Moderate Comfort." These lanes are typically painted or designated lanes on the road but lack the full physical separation that would offer more safety. While these lanes provide cyclists with their own space, they are adjacent to motor vehicle traffic, which may make them less comfortable for some users.

#### Low Comfort
All other types of bikeways, not falling into the protected or designated bike lane categories, are classified as "Low Comfort." These may include shared roadways where cyclists must navigate mixed traffic, offering little or no physical protection from vehicles. These segments are considered the least comfortable and safest for cyclists, often deterring usage by more risk-averse cyclists.

This classification method ensures that each bikeway segment is categorized into one of the three comfort levels based on its infrastructure type, enabling a detailed analysis of the usability of Toronto's cycling network.

\newpage



# References


